<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Location Logger</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database-compat.js"></script>

    <!-- FingerprintJS open-source library -->
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3.3.0/dist/fp.min.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCX7L7R6pwYUvggTGVqFRKqsz8n0NlaXrE",
            authDomain: "infologger-194e5.firebaseapp.com",
            databaseURL: "https://infologger-194e5-default-rtdb.firebaseio.com",
            projectId: "infologger-194e5",
            storageBucket: "infologger-194e5.appspot.com",
            messagingSenderId: "641296174415",
            appId: "1:641296174415:web:a620c0bcabcc3467f0493a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Get Device Information
        function getDeviceInfo() {
            const userAgent = navigator.userAgent;

            // Detect device type
            const deviceType = /Mobi|Android/i.test(userAgent) ? "Mobile" : "Desktop";

            // Detect operating system
            let os = "Unknown";
            if (/Windows/i.test(userAgent)) os = "Windows";
            else if (/Mac/i.test(userAgent)) os = "macOS";
            else if (/Linux/i.test(userAgent)) os = "Linux";
            else if (/Android/i.test(userAgent)) os = "Android";
            else if (/iPhone|iPad|iPod/i.test(userAgent)) os = "iOS";

            // Get screen resolution
            const screenResolution = `${screen.width}x${screen.height}`;

            // Get language preference
            const language = navigator.language || "Unknown";

            return { deviceType, os, screenResolution, language };
        }

        // Get browser information
        function getBrowserInfo() {
            const browser = {
                name: navigator.appName,
                version: navigator.appVersion,
                engine: navigator.product,
                userAgent: navigator.userAgent
            };

            // Check for more specific browser name and version
            const browserName = /(chrome|firefox|safari|opera|msie|trident)/i.exec(navigator.userAgent);
            if (browserName) {
                browser.name = browserName[0];
                const versionMatch = /(?:chrome|firefox|safari|opera|msie|trident)[/\s](\d+)/.exec(navigator.userAgent);
                if (versionMatch) {
                    browser.version = versionMatch[1];
                }
            }

            return browser;
        }

        // Get Central Time Timestamp
        function getCentralTimeTimestamp() {
            const options = {
                timeZone: "America/Chicago",
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit"
            };
            const formatter = new Intl.DateTimeFormat("en-US", options);
            return formatter.format(new Date());
        }

        // Get Local Timestamp and Browser Timezone
        function getLocalTimeInfo() {
            const localTimestamp = new Date().toLocaleString();
            const browserTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

            return { localTimestamp, browserTimezone };
        }

        // Get System Information
        function getSystemInfo() {
            const cpuInfo = navigator.hardwareConcurrency || "Unknown";  // Number of CPU cores
            const ram = navigator.deviceMemory || "Unknown";  // Available RAM (in GB)
            const installedFonts = [];  // Font detection requires additional libraries or manual checks
            const cookiesEnabled = navigator.cookieEnabled ? "Yes" : "No";

            return { cpuInfo, ram, installedFonts, cookiesEnabled };
        }

        // Log visitor information to Firebase
        function logVisitor(data) {
            const timestamp = getCentralTimeTimestamp(); // Central Time
            const deviceInfo = getDeviceInfo(); // Additional device info
            const browserInfo = getBrowserInfo(); // Browser info
            const systemInfo = getSystemInfo(); // System info
            const localTimeInfo = getLocalTimeInfo(); // Local time and timezone
            const visitorData = { ...data, ...deviceInfo, ...browserInfo, ...systemInfo, ...localTimeInfo, timestamp }; // Merge all data

            const dbRef = database.ref('logs');
            dbRef.push(visitorData)
                .then(() => {
                    console.log("Visitor logged successfully with timestamp:", timestamp);
                })
                .catch(error => {
                    console.error("Error logging visitor:", error);
                });
        }

        // Fetch location and log it
        function getLocation() {
            const apiKey = '3affc5d5ef228704c0cb6898b1bd541c';  // Replace with your ipstack API key
            const url = `https://api.ipstack.com/check?access_key=${apiKey}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Display location info
                    const locationInfo = `
                        <strong>IP:</strong> ${data.ip}<br>
                        <strong>Country:</strong> ${data.country_name}<br>
                        <strong>Region:</strong> ${data.region_name}<br>
                        <strong>City:</strong> ${data.city}<br>
                        <strong>Latitude:</strong> ${data.latitude}<br>
                        <strong>Longitude:</strong> ${data.longitude}<br>
                        <strong>Central Timestamp:</strong> ${getCentralTimeTimestamp()}<br>
                        <strong>Local Timestamp:</strong> ${getLocalTimeInfo().localTimestamp}<br>
                        <strong>Browser Timezone:</strong> ${getLocalTimeInfo().browserTimezone}<br>
                        <strong>Device Type:</strong> ${getDeviceInfo().deviceType}<br>
                        <strong>Operating System:</strong> ${getDeviceInfo().os}<br>
                        <strong>Screen Resolution:</strong> ${getDeviceInfo().screenResolution}<br>
                        <strong>Language:</strong> ${getDeviceInfo().language}<br>
                        <strong>Browser Name:</strong> ${getBrowserInfo().name}<br>
                        <strong>Browser Version:</strong> ${getBrowserInfo().version}<br>
                        <strong>Browser Engine:</strong> ${getBrowserInfo().engine}<br>
                        <strong>Cookies Enabled:</strong> ${getSystemInfo().cookiesEnabled}<br>
                    `;
                    document.getElementById("locationInfo").innerHTML = locationInfo;

                    // Log visitor info to Firebase
                    logVisitor(data);
                })
                .catch(error => {
                    console.error("Error fetching location data: ", error);
                });
        }

        // Initialize FingerprintJS and log data
        function logFingerprint() {
            FingerprintJS.load().then(fingerprintJS => {
                fingerprintJS.get().then(result => {
                    // FingerprintJS provides a unique visitor ID
                    const visitorID = result.visitorId;
                    console.log("Visitor ID from FingerprintJS:", visitorID);

                    // Log the fingerprint ID alongside other data
                    logVisitor({
                        fingerprintId: visitorID
                    });
                });
            });
        }

        // Automatically fetch location and fingerprint data on page load
        window.onload = function () {
            getLocation();
            logFingerprint();
        };
    </script>
</head>
<body>
    <h1>IP Location Logger</h1>
    <div id="locationInfo">Loading location information...</div>
</body>
</html>
